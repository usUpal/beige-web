(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[59],{9170:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/files",function(){return a(2862)}])},2862:function(e,t,a){"use strict";let l;a.r(t),a.d(t,{default:function(){return files}});var s=a(5893),i=a(6873),n=a(7294),o=a(9473),r=a(1467),d=a(3580),c=a(7814),u=a(9417),h=a(3197),m=a(2920),p=a(1355),x=a(806),f=a(4288),files_FileInfo=e=>{var t,a;let{fileDetailsModal:l,setFileDetailsModal:i,fileInfoData:o}=e,[r,d]=(0,n.useState)(!1),getSignedURL=async()=>{let e="An error occurred processing file download";try{var t,a;let l=await fetch("".concat(h.QP,"files/url/").concat(null==o?void 0:null===(t=o.metaData)||void 0===t?void 0:t.file_id));if(l.ok){let e=await l.json(),t=e.download_url,s=document.createElement("a");s.href=t,s.download=(null==o?void 0:null===(a=o.metaData)||void 0===a?void 0:a.file_name)||"file",s.click(),d(!1)}else m.Am.error(e,{position:m.Am.POSITION.TOP_RIGHT})}catch(t){m.Am.error(e,{position:m.Am.POSITION.TOP_RIGHT})}},handleFileDownload=async()=>{d(!0),await getSignedURL()};return(0,s.jsx)(p.u,{appear:!0,show:l,as:n.Fragment,children:(0,s.jsxs)(x.V,{as:"div",open:l,onClose:()=>i(!1),children:[(0,s.jsx)(p.u.Child,{as:n.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,s.jsx)("div",{className:"fixed inset-0"})}),(0,s.jsx)("div",{className:"fixed inset-0 bg-[black]/60 z-[999] overflow-y-auto",children:(0,s.jsx)("div",{className:"flex items-start justify-center min-h-screen px-4",children:(0,s.jsx)(p.u.Child,{as:n.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,s.jsxs)(x.V.Panel,{as:"div",className:"panel border-0 p-0 rounded-lg overflow-hidden my-8 w-full max-w-lg text-black dark:text-white-dark",children:[(0,s.jsxs)("div",{className:"flex bg-[#fbfbfb] dark:bg-[#121c2c] items-center justify-between px-5 py-3 h-12",children:[(0,s.jsx)("div",{className:"text-md font-bold",children:null==o?void 0:null===(t=o.metaData)||void 0===t?void 0:t.file_name}),(0,s.jsx)("button",{onClick:()=>i(!1),children:(0,s.jsx)(c.G,{size:"sm",icon:f.nYk})})]}),(0,s.jsxs)("div",{className:"p-5",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center gap-3",children:[(0,s.jsxs)("div",{className:"flex flex-column items-center gap-2 p-5 rounded-sm bg-amber-50 w-2/4",children:[(0,s.jsx)(c.G,{icon:f.Yws,size:"3x"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{children:null==o?void 0:o.size}),(0,s.jsx)("span",{className:"font-semibold",children:"File Size"})]})]}),(0,s.jsxs)("div",{className:"flex flex-column items-center gap-2 p-5 rounded-sm bg-amber-50 w-2/4",children:[(0,s.jsx)(c.G,{icon:f.chG,size:"3x"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{children:null==o?void 0:null===(a=o.metaData)||void 0===a?void 0:a.review_status}),(0,s.jsx)("span",{className:"font-semibold text-gray-800",children:"Review Status"})]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end items-center gap-2 mt-8",children:[(0,s.jsx)("button",{type:"button",className:"btn btn-danger",title:"Delete File",onClick:()=>i(!1),children:(0,s.jsx)(c.G,{icon:f.Vui})}),(0,s.jsx)("button",{type:"button",className:"btn btn-success",title:"Download File",disabled:r,onClick:handleFileDownload,children:(0,s.jsx)(c.G,{icon:u.q7m,bounce:r})})]})]})]})})})})]})})},files_FileBrowser=e=>{let{shootsData:t}=e,[a,l]=(0,n.useState)({}),[i,o]=(0,n.useState)(""),[r,p]=(0,n.useState)(!1),[x,f]=(0,n.useState)(!1),[j,b]=(0,n.useState)(!1),[g,v]=(0,n.useState)(!1),[w,N]=(0,n.useState)(null),fetchFileData=async e=>{let t=e+"/";o(t),f(!0);let a="An error occurred while fetching shoot data";try{let s=await fetch("".concat(h.QP,"files/directory?target_path=").concat(encodeURIComponent(t)));if(s.ok){let t=await s.json();t[e]?(l(t[e].items),b(!1)):b(!0),f(!1)}else m.Am.error(a,{position:m.Am.POSITION.TOP_RIGHT}),f(!1)}catch(e){console.log(e),m.Am.error("error "+a,{position:m.Am.POSITION.TOP_RIGHT}),f(!1)}},handleShootSelect=async e=>{if(e){let t=e.value;p(!0),await fetchFileData(t)}},renderFileOrFolder=(e,t)=>{let{type:i,path:n}=t,r=e.length>25?e.substring(0,22)+"...":e;if("directory"===i)return(0,s.jsxs)("div",{title:e,className:"flex w-min flex-col items-start",onDoubleClick:()=>{a&&(l(a[e].items),o(a[e].path.substring(1)))},children:[(0,s.jsx)(c.G,{icon:u.Pk,size:"5x",color:"#ACA686",className:"cursor-pointer"}),(0,s.jsx)("div",{className:"whitespace-no-wrap flex w-full justify-center overflow-hidden overflow-ellipsis font-semibold",children:(0,s.jsx)("span",{className:"break-all text-center",children:r})})]});if("file"===i){var d;let e=null==t?void 0:null===(d=t.metaData)||void 0===d?void 0:d.file_name,a=function(e){let t=e.toLowerCase();if(["jpg","jpeg","png","tiff","raw","nef","cr2","arw","orf","dng","bmp","mp4","mov","avi","mkv","webm","mpg","mpeg","wmv","flv","gif","ogg","3gp"].includes(t)){if(t.match(/(jpg|jpeg|png|tiff|raw|nef|cr2|arw|orf|dng|bmp|gif)/))return"photo";if(t.match(/(mp4|mov|avi|mkv|webm|mpg|mpeg|wmv|flv|ogg|3gp)/))return"video"}return"unknown"}(e.split(".").pop()),l=e.length>25?e.substring(0,22)+"...":e;return(0,s.jsxs)("div",{title:e,className:"flex w-min flex-col items-start",onDoubleClick:()=>{N(t),v(!0),console.log(t)},children:[(0,s.jsx)(c.G,{icon:"video"===a?u.hvm:u.Oi0,size:"5x",color:"#333434",className:"cursor-pointer"}),(0,s.jsx)("div",{className:"whitespace-no-wrap flex w-full justify-center overflow-hidden overflow-ellipsis font-semibold",children:(0,s.jsx)("span",{className:"break-all text-center",children:l})})]})}};return(0,s.jsxs)("div",{className:"h-[70vh] overflow-y-auto",children:[(0,s.jsx)(files_FileInfo,{fileDetailsModal:g,setFileDetailsModal:v,fileInfoData:w}),(0,s.jsxs)("div",{className:"pt-5",children:[(0,s.jsxs)("div",{className:"flex flex-col flex-wrap items-center justify-between md:flex-row xl:w-auto",children:[(e=>{let t=e.split("/"),a=[],l="";for(let e=0;e<t.length;e++){let i=t[e];l+=i,""!==i&&a.push((0,s.jsx)("li",{children:(0,s.jsxs)("button",{className:"hover:text-gray-500/70 dark:hover:text-white-dark/70 ".concat(e===t.length?"font-extrabold":""),children:["\xa0",i]})},l)),e<t.length-1&&a.push((0,s.jsx)("li",{className:"before:px-1.5 before:content-['/']"},"separator-".concat(l)))}return(0,s.jsxs)("ol",{className:"flex items-center font-semibold text-gray-500 dark:text-white-dark",children:[(0,s.jsx)("li",{children:(0,s.jsxs)("button",{className:"hover:text-gray-500/70 dark:hover:text-white-dark/70",children:[(0,s.jsx)(c.G,{icon:u._jT})," /"]})}),a]})})(i),(0,s.jsx)("div",{className:"flex-1 md:flex-auto",children:(0,s.jsxs)("div",{className:"flex items-center justify-center gap-3 md:justify-end",children:[(0,s.jsx)("div",{className:"w-48",children:(0,s.jsx)(d.ZP,{options:t,isSearchable:!0,onChange:handleShootSelect})}),(0,s.jsx)("button",{type:"button",title:"Create Folder",className:"rounded-md bg-[#f4f4f4] p-1 ".concat(r?"enabled:hover:bg-primary-light":"disabled cursor-not-allowed opacity-60"," dark:bg-white-dark/20 ").concat(r?"enabled:dark:hover:bg-white-dark/30":""),disabled:!r,children:(0,s.jsx)(c.G,{icon:u.x58,color:"#2196f3",size:"lg",className:"cursor-pointer"})}),(0,s.jsx)("button",{type:"button",className:"rounded-md bg-[#f4f4f4] p-1 ".concat(r?"enabled:hover:bg-primary-light":"disabled cursor-not-allowed opacity-60"," dark:bg-white-dark/20 ").concat(r?"enabled:dark:hover:bg-white-dark/30":""),disabled:!r,children:(0,s.jsx)(c.G,{icon:u.EyR,className:"cursor-pointer"})}),(0,s.jsx)("button",{type:"button",className:"rounded-md bg-[#f4f4f4] p-1 ".concat(r?"enabled:hover:bg-primary-light":"disabled cursor-not-allowed opacity-60"," dark:bg-white-dark/20 ").concat(r?"enabled:dark:hover:bg-white-dark/30":""),disabled:!r,children:(0,s.jsx)(c.G,{icon:u.yOZ,className:"cursor-pointer"})})]})})]}),a&&!j&&!x&&(0,s.jsx)("div",{className:"mt-5 flex flex-wrap justify-normal gap-6",children:Object.keys(a).map(e=>{let t=a[e];return(0,s.jsx)(n.Fragment,{children:renderFileOrFolder(e,t)},e)})}),!x&&!a&&!j&&(0,s.jsx)("div",{className:"mt-5 text-center",children:(0,s.jsx)("span",{children:"Select a shoot to browsing"})}),!x&&j&&(0,s.jsx)("div",{className:"mt-5 text-center",children:(0,s.jsx)("span",{children:"No content found in this directory"})}),x&&(0,s.jsxs)("div",{className:"mt-5",children:[(0,s.jsx)("div",{className:"m-auto mb-5 h-4 w-4",children:(0,s.jsx)("span",{className:"inline-flex h-full w-full animate-ping rounded-full bg-warning"})}),(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)("span",{className:"animate-pulse",children:"Loading order files"})})]})]})]})};l=localStorage&&localStorage.getItem("userData")&&JSON.parse(localStorage.getItem("userData")).id;let j={PENDING:"pending",UPLOADING:"uploading",PAUSED:"paused",UPLOADED:"uploaded",FAILED:"failed",CANCELLED:"cancelled"},b=[{value:"Photo",label:"Photo"},{value:"Video",label:"Video"}],g=[{value:"Raw",label:"Raw"},{value:"Edited",label:"Edited"}];var files=()=>{let e;let t=(0,o.I0)();(0,n.useEffect)(()=>{t((0,r.Iw)("File Manager"))});let[a,p]=(0,n.useState)([]),[x,f]=(0,n.useState)(!1);(0,n.useEffect)(()=>{f(!0)});let[v,w]=(0,n.useState)(null),[N,y]=(0,n.useState)([]),[F,D]=(0,n.useState)(null),[k,S]=(0,n.useState)("Photo"),[O,P]=(0,n.useState)("Raw"),[U,E]=(0,n.useState)(!1),fetchOrdersForCP=()=>{let e="".concat(h.QP,"orders?sortBy=createdAt:desc&cp_id=").concat(l,"&limit=5");fetch(e,{method:"GET",headers:{Authorization:"Bearer <token>"}}).then(e=>{if(!e.ok)throw Error("Network response was not ok");return e.json()}).then(e=>{let t=e.results,a=t.map(e=>({value:null==e?void 0:e.id,label:null==e?void 0:e.order_name}));y(a)}).catch(e=>{console.error("Error fetching orders:",e)})};(0,n.useEffect)(()=>{fetchOrdersForCP()},[]),(0,n.useEffect)(()=>{F?E(!1):E(!0)},[F]);let T="".concat(h.QP,"files/upload"),C={UPLOAD:{URL:T,METHOD:"PUT"},UPLOAD_STATUS:{URL:T,METHOD:"GET"},UPLOAD_REQUEST:{URL:T,METHOD:"POST"}},[A,I]=(0,n.useState)([]),[_,M]=(0,n.useState)(new Map),[L,R]=(0,n.useState)(new WeakMap),[G,z]=(0,n.useState)(0),updateFileMapData=(e,t)=>{M(a=>a.set(e,{...a.get(e),...t}))},updateFileRequestMapData=(e,t)=>{R(a=>a.set(e,{...a.get(e),...t}))},requestFileUpload=async e=>{let t={size:e.size,status:j.PENDING,progress:0,uploadedChunks:0,fileObject:e};updateFileMapData(e,t);try{let t=await fetch(C.UPLOAD_REQUEST.URL,{method:C.UPLOAD_REQUEST.METHOD,headers:{"Content-Type":"application/json"},body:JSON.stringify({fileName:e.name,fileExt:e.name.substring(e.name.lastIndexOf(".")),orderId:v,shootDate:F,contentType:k,fileType:O})}),a=await t.json();updateFileMapData(e,{id:a.id}),updateFileRequestMapData(e,{request:null,options:a}),uploadFileChunk(e,a.id,a.size)}catch(e){console.error(e)}},uploadFileChunk=(e,t,a)=>{let l=new FormData,s=new XMLHttpRequest,i=e.slice(a);l.append("fileId",t),l.append("file",i),s.open(C.UPLOAD.METHOD,C.UPLOAD.URL,!0),s.setRequestHeader("Content-Range","bytes ".concat(a,"-").concat(a+i.size,"/").concat(e.size)),s.setRequestHeader("X-File-Id",t),s.onload=()=>{200===s.status?updateFileMapData(e,{status:j.UPLOADED}):updateFileMapData(e,{status:j.FAILED}),z(Math.floor(1e6*Math.random()))},s.ontimeout=()=>{updateFileMapData(e,{status:j.FAILED}),z(Math.floor(1e6*Math.random()))},s.onabort=()=>{updateFileMapData(e,{status:j.PAUSED}),z(Math.floor(1e6*Math.random()))},s.onerror=()=>{updateFileMapData(e,{status:j.FAILED}),z(Math.floor(1e6*Math.random()))},s.upload.onprogress=t=>{z(Math.floor(1e6*Math.random()));let l=a+t.loaded,s=Math.min(l,e.size),i=Math.round(s/e.size*100);updateFileMapData(e,{status:j.UPLOADING,progress:i,uploadedChunks:s})},updateFileRequestMapData(e,{request:s}),s.send(l)},getUploadedFileInfo=async e=>{let t=_.get(e).id;console.log(t);try{let e=await fetch("".concat(C.UPLOAD_STATUS.URL,"?fileId=").concat(t));return await e.json()}catch(e){return 0}},pauseFileUpload=e=>{let t=L.get(e);return!!t&&!!t.request&&(t.request.abort(),!0)},resumeFileUpload=async e=>{let t=await getUploadedFileInfo(e),a=t.size;a&&0!==a?uploadFileChunk(e,t.id,a):alert("Cannot resume file upload")},retryFileUpload=async e=>{let t=await getUploadedFileInfo(e),a=t.size;a||m.Am.error("Cannot retry file upload! Please try again",{position:m.Am.POSITION.TOP_RIGHT}),uploadFileChunk(e,t.id,a)},cancelFileUpload=async e=>{pauseFileUpload(e)&&updateFileMapData(e,{status:j.CANCELLED}),L.delete(e),_.delete(e)},bytesToKilobytes=e=>Math.round(e/1024),q=A.map(e=>{var t,a,l,i,n,o,r;let d=null===(t=_.get(e))||void 0===t?void 0:t.status;return"cancelled"!==d&&(0,s.jsxs)("div",{className:"fileUploadElement",children:[d,(0,s.jsxs)("div",{className:"align-center rounded-2 mb-3 flex flex-col flex-wrap justify-between gap-3 bg-white p-3 shadow-sm",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"font-semibold",children:null==e?void 0:e.name}),(0,s.jsxs)("span",{className:"text-sm text-gray-500",children:[null===(a=_.get(e))||void 0===a?void 0:a.progress,"%"]})]}),(0,s.jsx)("div",{className:"mt-2 h-2 bg-gray-200",children:(0,s.jsx)("div",{className:"h-full bg-green-500 bg-success",style:{width:"".concat(null===(l=_.get(e))||void 0===l?void 0:l.progress,"%")}})})]}),(0,s.jsxs)("div",{className:"align-center flex flex-wrap justify-between",children:[(0,s.jsx)("div",{className:"flex flex-col justify-center",children:(0,s.jsxs)("span",{className:"font-thin",children:[bytesToKilobytes(null===(i=_.get(e))||void 0===i?void 0:i.uploadedChunks)," KB / ",bytesToKilobytes(null==e?void 0:e.size)," KB"]})}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center space-x-1",children:[(null===(n=_.get(e))||void 0===n?void 0:n.status)===j.UPLOADING&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{title:"Pause Upload",onClick:()=>pauseFileUpload(e),className:"btn btn-warning actionBtn flex h-8 w-8 items-center justify-center rounded-full p-0",children:(0,s.jsx)(c.G,{icon:u.XQY})}),(0,s.jsxs)("button",{title:"Cancel Upload",onClick:()=>cancelFileUpload(e),className:"btn btn-danger actionBtn flex h-8 w-8 items-center justify-center rounded-full p-0",children:[(0,s.jsx)(c.G,{icon:u.gPx}),(0,s.jsx)("i",{className:"fa-solid fa-ban"})]})]}),(null===(o=_.get(e))||void 0===o?void 0:o.status)===j.PAUSED&&(0,s.jsx)("button",{title:"Resume Upload",onClick:()=>resumeFileUpload(e),className:"btn btn-primary actionBtn flex h-8 w-8 items-center justify-center rounded-full p-0",children:(0,s.jsx)(c.G,{icon:u.zc})}),(null===(r=_.get(e))||void 0===r?void 0:r.status)===j.FAILED&&(0,s.jsx)("button",{title:"Retry Upload",onClick:()=>retryFileUpload(e),className:"btn btn-success actionBtn flex h-8 w-8 items-center justify-center rounded-full p-0",children:(0,s.jsx)(c.G,{icon:u.A$k})})]})]})]})]},e.name)});return(0,s.jsx)("div",{className:"w-full space-y-8 pt-5",children:(0,s.jsx)("div",{className:"panel",id:"pills",children:(0,s.jsx)("div",{className:"mb-5",children:x&&(0,s.jsxs)(i.O.Group,{children:[(0,s.jsxs)(i.O.List,{className:"mt-3 flex flex-wrap",children:[(0,s.jsx)(i.O,{as:n.Fragment,children:e=>{let{selected:t}=e;return(0,s.jsx)("button",{className:"".concat(t?"bg-primary text-white !outline-none":"","\n                                                    ' -mb-[1px] block rounded p-3.5 py-2 hover:bg-primary hover:text-white ltr:mr-2 rtl:ml-2"),children:"Upload"})}}),(0,s.jsx)(i.O,{as:n.Fragment,children:e=>{let{selected:t}=e;return(0,s.jsx)("button",{className:"".concat(t?"bg-primary text-white !outline-none":""," -mb-[1px] block rounded p-3.5 py-2 hover:bg-primary hover:text-white ltr:mr-2 rtl:ml-2"),children:"Browse"})}})]}),(0,s.jsxs)(i.O.Panels,{children:[(0,s.jsx)(i.O.Panel,{children:(0,s.jsxs)("div",{className:"pt-5",children:[(0,s.jsxs)("div",{className:"mx-auto flex max-w-[900px] flex-col items-center gap-4 md:flex-row",children:[(0,s.jsxs)("div",{className:"my-2 w-full flex-1",children:[(0,s.jsx)("label",{children:"Select Shoot"}),(0,s.jsx)(d.ZP,{onChange:e=>{w(e.value)},defaultValue:N[0],options:N,isSearchable:!0})]}),(0,s.jsxs)("div",{className:"w-full flex-1",children:[(0,s.jsx)("label",{children:"Shoot Date"}),(0,s.jsx)("input",{onChange:e=>{D(e.target.value)},type:"date",className:"form-input"})]}),(0,s.jsxs)("div",{className:"w-full flex-1",children:[(0,s.jsx)("label",{children:"Content Type"}),(0,s.jsx)(d.ZP,{onChange:e=>{S(e.value)},defaultValue:b[0],options:b,isSearchable:!0})]}),(0,s.jsxs)("div",{className:"w-full flex-1",children:[(0,s.jsx)("label",{children:"File Type"}),(0,s.jsx)(d.ZP,{onChange:e=>{P(e.value)},defaultValue:g[0],options:g,isSearchable:!0})]})]}),(0,s.jsxs)("div",{className:"active pt-5 ".concat(U?"disabled":""),children:[U?(0,s.jsxs)("div",{className:"bg-slate-300 btn-lg m-auto w-48 rounded-lg text-slate-400 text-center",children:[(0,s.jsx)(c.G,{icon:u.cC_}),"\xa0Select Files"]}):(0,s.jsxs)("label",{className:"btn btn-info btn-lg m-auto w-48 cursor-pointer",children:[(0,s.jsx)(c.G,{icon:u.cC_}),"\xa0Select Files",(0,s.jsx)("input",{type:"file",className:"hidden",multiple:!0,id:"selectFileInput",accept:(e=[],"Photo"===k?e.push("image/*"):"Video"===k&&e.push("video/*"),"Raw"===O&&(e.push(".raw"),e.push(".nef")),e.join(",")),onChange:e=>{let t=e.target.files;[...t].forEach(requestFileUpload),I([...A,...t]),e.target.value=""}})]}),(0,s.jsx)("div",{className:"mx-auto max-w-[900px]",children:q})]})]})}),(0,s.jsx)(i.O.Panel,{children:(0,s.jsx)(files_FileBrowser,{shootsData:N})})]})]})})})})}}},function(e){e.O(0,[976,378,383,774,888,179],function(){return e(e.s=9170)}),_N_E=e.O()}]);